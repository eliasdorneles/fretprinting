<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Fret Printing - Guitar Fretboard Diagrams</title>
<style>
* { margin:0; padding:0; border-spacing:0; }
h1 a, h1 a:visited, h1 a:focus { color: black !important; text-decoration: none; }
body { font-family:Arial,Helvetica,sans-serif; font-size:14px; }
.fretboard { float:left; margin:11px; }
.fretboard tr { padding:0; margin:0; }
.fretboard tr td { width:18px; height:24px; padding:0; margin:0; font-size:12pt; text-align:center; border-top:1px solid #aaa; border-left:1px solid black; }
.fretboard tr td.laststr { border-right:1px solid black;}
.fretboard tr.lastfret td { border-bottom:1px solid black;}
a:visited { color: blue; }
.spacer { margin-right: 15px; }
@media print {
    #interface { display:none; }
    .fretboard {
        page-break-inside: avoid;
    }
    @page {
        /* Do not change - this affects the presets */
        margin: 0.5cm;
    }
}
#help { display:none; }
.fretboard tr td.fretnumber { font-size:10px; border:0; width:5px; vertical-align:bottom; text-align:right; }

/* make-it-pretty stuff */
#interface { padding:10px; }
#interface h2 { font-size:14px; margin-bottom: 10px; color: #555; }
#interface table tr td { padding:3px; padding-right: 15px; }
/*#interface table tr td.label { padding-right:3px; padding-left: 15px; }*/
#interface input { padding:0 4px; }
#interface select { padding:0 4px; }
#help { width:500px; position:absolute; z-index:1; top:80px; left:50px; border-width: 2px; line-height: 18px; }
/*
#help { width:460px; padding:15px; position:absolute; background-color:#dee; border:2px solid black; z-index:1; top:80px; left:50px; }
 */
#help p, #help sup { padding:3px; }
a.btn { text-decoration: none; }
.advanced { display: none; }
.pt { display: none; }
</style>
<link media="all" href="css/bootstrap.min.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script>
var fretboard = function(n_strings, inlay_repr, dot_mark, show_numbers){
    var fret = function(num_str, dotted, two){
        if (dotted){
            var place = two ? 1 : (num_str / 2 - 1) | 0; // cast-to-int HACK!
        }
        var fret_html = "<tr>";
        for(var i = 0; i < num_str - 1; i++){
            if (dotted && i == place){
                fret_html += "<td>" + dot_mark + "</td>";
                place = two ? num_str - 3 : place;
            } else {
                fret_html += i==num_str-2 ? '<td class="laststr">&nbsp;</td>' : '<td>&nbsp;</td>';
            }
        }
        fret_html += "</tr>";
        return fret_html;
    }
    var fret_for_repr = {
        '-': fret(n_strings),
        '.': fret(n_strings, true),
        ':': fret(n_strings, true, true)
    }
    var fretboard_elem = $('<table class="fretboard"></table>');
    var numbers_style = show_numbers ? '' : ' style="visibility:hidden"';
    for (var i = 0; i < inlay_repr.length; i++){
        var e = $(fret_for_repr[inlay_repr[i]]);
        if (i == inlay_repr.length - 1){
            e.attr('class', 'lastfret');
        }
        e.prepend('<td class="fretnumber"' + numbers_style + '>' + (i+1) + '</td>');
        fretboard_elem.append(e);
    }
    return fretboard_elem;
}
// handle url parameters
function get_url_parameters(){
    var params = {};
    var index_params = window.location.href.indexOf('#');
    if (index_params > 0){
        var hashes = window.location.href.slice(index_params + 1).split('&');
        for(var i = 0; i < hashes.length; i++){
            var hash = hashes[i].split('=');
            params[hash[0]] = hash[1];
        }
    }
    return params;
}
function create_link(how_many, inlay_variation, num_strings, frets_per_diagram, show_numbers, size_diagram){
    var link_params = {how_many: how_many, inlay_variation: inlay_variation, size_diagram: size_diagram,
        num_strings: num_strings, frets_per_diagram: frets_per_diagram, show_numbers: show_numbers}
        var href = window.location.href;
        if (href.indexOf('#') > 0){
            href = href.substring(0, href.indexOf('#'));
        }
        href += '#';
        for(var key in link_params){
            href += key + '=' + link_params[key] + '&';
        }
        href = href.substring(0, href.length - 1);
        return href;
}
function update_form_with_url_params(){
    var params = get_url_parameters();
    // TODO: validate input?
    for(var key in params){
        if (key == 'show_numbers'){
            $('#' + key).attr('checked', params[key] == 'true');
        } else {
            if (key != '')
                $('#' + key).val(params[key]);
        }
    }
}
var generate = function(){
    var how_many = $('#how_many').val();
    var dot_mark = '&#x25cf;';
    var inlay_variation = $('#inlay_variation').val();
    var num_strings = $('select#num_strings').val();
    var frets_per_diagram = $('select#frets_per_diagram').val();
    var show_numbers = $('#show_numbers').is(':checked');
    var size_diagram = $('select#size_diagram').val();

    // update link
    var href = create_link(how_many, inlay_variation, num_strings, frets_per_diagram, show_numbers, size_diagram);
    $('#input_link_this').val(href);

    if (frets_per_diagram < inlay_variation.length){
        inlay_variation = inlay_variation.substr(0, frets_per_diagram);
    }

    // empty container
    $('#main').empty();
    // draw fretboards
    for(var i = 0; i < how_many; i++){
        $('#main').append(fretboard(num_strings, inlay_variation, dot_mark, show_numbers));
    }
    // adjust size
    var css_size_style = {
        'Tiny':  { width: '18px', height: '24px'},
        'Small': { width: '22px', height: '30px'},
        'Medium':  { width: '28px', height: '38px'},
        'Large':  { width: '36px', height: '50px'},
        'X-Large':  { width: '40px', height: '56px'},
    }
    $('.fretboard tr td').css(css_size_style[size_diagram]);
}
$(function(){
    var translations = [
        ['Tiny', 'Bem Pequeno'],
        ['Small', 'Pequeno'],
        ['Medium', 'Médio'],
        ['Large', 'Grande'],
        ['X-Large', 'Bem Grande'],
    ];
    function fill_options(elem, options, defval){
        // setup a select dropdown with options and default value
        $.each(options, function(){
            var html = $('<option value="' + this + '">' + this + '</option>');
            if (this == defval) {
                html.attr('selected', '1');
            }
            elem.append(html);
        });
    }
    function list_range(start, end){
        // create a list from a range
        var arr = [];
        for(var i = start; i <= end; i += 1){
            arr.push(i);
        }
        return arr;
    }
    // setup controls with defaults
    fill_options($('select#how_many'), list_range(1, 30), 3);
    fill_options($('select#frets_per_diagram'), list_range(4, 16), 14);
    fill_options($('select#num_strings'), list_range(4, 8), 6);
    fill_options($('select#size_diagram'), ['Tiny', 'Small', 'Medium', 'Large', 'X-Large'], 'Large');
    $('select#inlay_variation').append('<option value="----------------">No Inlay</option>');
    $('select#inlay_variation').append('<option value="--.-.-.-.--:--.-" selected>Variation 1</option>');
    $('select#inlay_variation').append('<option value="--.-.-.--.-:--.-">Variation 2</option>');
    $('#print_btn').click(function(){
        window.print();
    });
    $('#help_btn').click(function(){
        $('#help').show('fast');
    });
    $('.help_close_btn').click(function(){
        $('#help').hide('fast');
    });
    $('#interface form input').change(generate);
    $('#interface form select').change(generate);

    $('#toggleLanguage').toggle(function(){
        var $this = $(this);
        $this.html('English version');
        $('.eng').hide();
        $('.pt').show();
    }, function(){
        var $this = $(this);
        $this.html('Versão em Português');
        $('.eng').show();
        $('.pt').hide();
    });
    $('#toggleAdvanced').toggle(function(){
        $(this).addClass('active');
        $('.advanced').show();
    }, function(){
        $(this).removeClass('active');
        $('.advanced').hide();
    });
    $('.preset').click(function(){
        var href = $(this).attr('href');
        window.location.href = href;
        update_form_with_url_params();
        generate();
    });
    $('#input_link_this').click(function() {
        $(this).select();
    });

    // generate for defaults
    update_form_with_url_params();
    generate();
    $(document).keyup(function(e) {
        // hotkeys
        var ESCAPE = 27;
        if (e.keyCode == ESCAPE) {
            $('#help').hide();
        }
    });
});
</script>
</head>
<body>
<div id="interface">
    <h1>
        <a href="index.html">Fret Printing</a>
    </h1>
    <h2 class="eng">Setup and print your fretboard diagrams</h2>
    <h2 class="pt">Configure e imprima diagramas para violão, guitarra e baixo</h2>
    <form>
        <div>
            <strong>PRESETS:</strong>
            <br />
            <a href="#how_many=3&inlay_variation=--.-.-.-.--:--.-&size_diagram=Large&num_strings=6&frets_per_diagram=14&show_numbers=true" class="preset">
                <span class="eng">6-Strings Guitar Fretboard</span>
                <span class="pt">Braço de violão/guitarra 6 cordas</span>
            </a>
            <br />
            <a href="#how_many=4&inlay_variation=--.-.-.-.--:--.-&size_diagram=Large&num_strings=4&frets_per_diagram=14&show_numbers=true" class="preset">
                <span class="eng">4-String Bass Fretboard</span>
                <span class="pt">Braço de Baixo 4 cordas</span>
            </a>
            <br />
            <a href="#how_many=9&inlay_variation=----------------&size_diagram=Large&num_strings=6&frets_per_diagram=5&show_numbers=false" class="preset">
                <span class="eng">Guitar Chord Boxes</span>
                <span class="pt">Diagramas para Acordes violão/guitarra</span>
            </a>
            <br />
            <a href="#how_many=8&inlay_variation=--.-.-.-.--:--.-&size_diagram=Small&num_strings=6&frets_per_diagram=16&show_numbers=true" class="preset">
                <span class="eng">Guitar Fretboard - smaller size</span>
                <span class="pt">Braço de violão/guitarra 6 cordas - tamanho menor</span>
            </a>
            <br />
            <a href="#how_many=3&inlay_variation=--.-.-.-.--:--.-&size_diagram=Large&num_strings=5&frets_per_diagram=14&show_numbers=false" class="preset">
                <span class="eng">5-Strings Bass Fretboard</span>
                <span class="pt">Braço de Baixo 5 cordas</span>
            </a>
            <br />
            <br />
            <a href="javascript:void(0)" id="print_btn" class="btn btn-primary">
                <span class="eng">Print diagram</span>
                <span class="pt">Imprimir diagrama</span>
            </a>
            <span class="spacer"></span>
            <a href="javascript:void()" id="toggleLanguage">Versão em Português</a>
            <a href="javascript:void(0)" id="help_btn" class="btn">
                <span class="eng">About</span>
                <span class="pt">Sobre</span>
            </a>
            <span class="spacer"></span>
            <a href="javascript:void()" class="btn btn-info" id="toggleAdvanced">
                <span class="eng">Show All Settings</span>
                <span class="pt">Configurações Avançadas</span>
            </a>
        </div>
        <br />
        <table>
            <tr class="advanced">
                <td class="label">
                    <span class="eng">How many diagrams?</span>
                    <span class="pt">Quantos diagramas?</span>
                </td>
                <td><select id="how_many"></select></td>
                <td class="label">
                    <label for="show_numbers">
                        <span class="eng">Show numbers?</span>
                        <span class="pt">Mostrar números?</span>
                        <input type="checkbox" id="show_numbers" checked />
                    </label>
                </td>
                <td></td>
                <td class="label">
                    <span class="eng">Inlay variation:</span>
                    <span class="pt">Marcações:</span>
                </td>
                <td><select id="inlay_variation"></select></td>
            </tr>
            <tr class="advanced">
                <td class="label">
                    <span class="eng">How many strings?</span>
                    <span class="pt">Quantas cordas?</span>
                </td>
                <td><select id="num_strings"></select></td>
                <td class="label">
                    <span class="eng">How many frets?</span>
                    <span class="pt">Quantos trastes?</span>
                </td>
                <td><select id="frets_per_diagram"></select></td>
                <td class="label">
                    <span class="eng">Size:</span>
                    <span class="pt">Tamanho:</span>
                </td>
                <td><select id="size_diagram"></select></td>
            </tr>
            <tr class="advanced">
                <td colspan="6">
                    <span class="eng">Link to this diagram:</span>
                    <span class="pt">Link para esse diagrama:</span>
                    <input type="text" id="input_link_this" style="width:300px" />
                </td>
            </tr>
        </table>
    </form>
    <div id="help" class="alert alert-info">
        <button type="button" class="close help_close_btn" data-dismiss="alert">&times;</button>
        <p><strong>Fret Printing</strong></p>
        <div class="eng">
            <p>Use this little tool to print diagrams for the fretboard of your instrument (guitar, bass, violin, etc), so you can write on them the patterns for chords, scales, modes or whatever it is that you're working on.</p>
            <p>Taking your time writing down the patterns helps you to memorize them quickly. Hopefully, soon you will be able to apply them in your playing. :-)</p>
            <p>Should you have any questions, suggestions of improvement, feel free to drop me an email: <a href="mailto:eliasdorneles@gmail.com">eliasdorneles@gmail.com</a> or, fork me at github: <a href="https://github.com/eliasdorneles/fretprinting">https://github.com/eliasdorneles/fretprinting</a></p>
            <sup>For the best results, use a modern browser like <a href="http://www.getfirefox.com">Firefox</a> or <a href="http://www.google.com/chrome">Chrome</a>.</sup>
            <p>Thank you!</p>
        </div>
        <div class="pt">
            <p>Use esta ferramenta para imprimir diagramas do braço da sua guitarra ou baixo, para você usar nos seus estudos de acordes, escalas, modos ou seja lá o que for que você esteja estudando no momento.</p>
            <p>Parando pra escrever num papel os padrões do braço ajuda a memorizá-los mais rapidamente, e logo você deve conseguir usá-los nas suas tocanças. :)</p>
            <p>Caso tenha alguma pergunta, sugestão ou reclamação, mande-me um email: <a href="mailto:eliasdorneles@gmail.com">eliasdorneles@gmail.com</a>. O códito é aberto e pode ser obtido em: <a href="https://github.com/eliasdorneles/fretprinting">https://github.com/eliasdorneles/fretprinting</a></p>
            <sup>Para melhores resultados, use um navegador moderno como o <a href="http://www.getfirefox.com">Firefox</a> ou o <a href="http://www.google.com/chrome">Chrome</a>.</sup>
            <p>Valeu!</p>
        </div>
        <p>-- <a href="http://eljunior.wordpress.com">Elias Dorneles</a></p>
        <div style="text-align:right"><a href="javascript:void(0)" class="btn btn-mini help_close_btn">
                <span class="eng">Close</span>
                <span class="pt">Fechar</span>
        </a></div>
    </div>
</div>
<div id="main">
</div>
</body>
</html>
